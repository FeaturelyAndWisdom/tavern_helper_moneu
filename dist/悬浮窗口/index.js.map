{"version":3,"file":"index.js","mappings":"4EAAA,MAAM,EAA+BA,ICI/BC,EAAa,CAAEC,MAAO,mGACtBC,EAAa,CAAED,MAAO,+HACtBE,EAAa,CAAEF,MAAO,2BACtBG,EAAa,CAAEH,MAAO,4BACtBI,EAAa,CAAEJ,MAAO,aACtBK,EAAa,CAAEL,MAAO,kCACtBM,EAAa,CAAEN,MAAO,0BACtBO,EAAa,CAAC,WACdC,EAAa,CAAER,MAAO,kCACtBS,EAAc,CAAET,MAAO,oCACvBU,EAAc,CAAEV,MAAO,kCCT7B,GDU6B,qBAAiB,CAC1CW,OAAQ,SACR,KAAAC,CAAMC,GACF,MAAMC,GAAY,IAAAC,MAAI,GAChBC,GAAY,IAAAD,KAAI,IAChBE,GAAS,IAAAF,KAAI,MACbG,GAAe,IAAAH,KAAI,GACnBI,EAAU,CACZ,CAAEC,KAAM,KAAMC,KAAM,kBAAmBC,OAAQ,WAC/C,CAAEF,KAAM,KAAMC,KAAM,eAAgBC,OAAQ,SAC5C,CAAEF,KAAM,KAAMC,KAAM,cAAeC,OAAQ,QAC3C,CAAEF,KAAM,KAAMC,KAAM,aAAcC,OAAQ,aAO9C,SAASC,IACLN,EAAOO,MAAQC,YAAYC,mBAC3BR,EAAaM,MAAQG,mBAAqB,CAC9C,CAmBA,SAASC,IACAZ,EAAUQ,MAAMK,QAIrBC,OAAOC,QAAQ,QAAQf,EAAUQ,SACjCR,EAAUQ,MAAQ,IAJdM,OAAOE,QAAQ,QAKvB,CACA,OAnCA,IAAAC,WAAU,KACNV,IACAW,QAAQC,cAAcC,aAAcb,GACpCW,QAAQC,cAAcE,iBAAkBd,KAgCrC,CAACe,EAAMC,MACF,kBAAc,wBAAoB,MAAOxC,EAAY,EACzD,wBAAoB,YACpB,wBAAoB,MAAOE,EAAY,CACnCsC,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAEvC,MAAO,2BAA6B,EACvF,wBAAoB,IAAK,CAAEA,MAAO,0CAClC,wBAAoB,OAAQ,CAAEA,MAAO,iBAAmB,UACxD,KACJ,wBAAoB,MAAOE,EAAY,EACnC,wBAAoB,SAAU,CAC1BF,MAAO,wFACPwC,QAASD,EAAO,KAAOA,EAAO,GAAME,GAAY3B,EAAUU,QAAS,WAAOV,KAC3E,EACC,wBAAoB,IAAK,CACrBd,OAAO,oBAAgB,EAAC,WAAOc,GAAa,sBAAwB,oBAAqB,aAC1F,KAAM,UAIrB,wBAAoB,YACpB,qBAAgB,wBAAoB,MAAOX,EAAY,EACnD,wBAAoB,cACpB,wBAAoB,MAAOC,EAAY,EACnC,wBAAoB,MAAOC,EAAY,CACnCkC,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAEvC,MAAO,2CAA6C,QAAS,KACnH,wBAAoB,MAAOM,EAAY,GAClC,kBAAc,wBAAoB,WAAW,MAAM,gBAAYa,EAAUG,IAC/D,wBAAoB,SAAU,CACjCoB,IAAKpB,EAAOF,KACZpB,MAAO,+EACPwC,QAAUC,GAxD1C,SAAsBnB,GAClB,OAAQA,EAAOA,QACX,IAAK,UACDC,IACAO,OAAOa,KAAK,SACZ,MACJ,IAAK,QACD3B,EAAUQ,MAAQ,GAClBM,OAAOa,KAAK,SACZ,MACJ,IAAK,OACDb,OAAOC,QAAQ,QACf,MACJ,IAAK,WACDD,OAAOa,KAAK,WAGxB,CAuCqD,CAAcrB,IACpC,EACC,wBAAoB,IAAK,CACrBtB,OAAO,oBAAgB,CAACsB,EAAOD,KAAM,UACtC,KAAM,IACT,qBAAiB,KAAM,qBAAiBC,EAAOF,MAAO,IACvD,EAAeb,IAClB,UAGZ,wBAAoB,MAAOC,EAAY,CACnC+B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAEvC,MAAO,2CAA6C,QAAS,KACnH,wBAAoB,MAAOS,EAAa,EACpC,wBAAoB,IAAK,KAAM,UAAW,sBAAiB,WAAOQ,IAAW,KAAM,IACnF,wBAAoB,IAAK,KAAM,UAAW,sBAAiB,WAAOC,IAAgB,QAG1F,wBAAoB,MAAOR,EAAa,CACpC6B,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAEvC,MAAO,2CAA6C,QAAS,KACnH,qBAAgB,wBAAoB,WAAY,CAC5C,sBAAuBuC,EAAO,KAAOA,EAAO,GAAME,IAAY,WAAOzB,GAAa,EAAYQ,MAAQiB,EAAS,MAC/GzC,MAAO,+HACP4C,YAAa,aACd,KAAM,KAAuB,CAC5B,CAAC,cAAa,WAAO5B,OAEzB,wBAAoB,SAAU,CAC1BhB,MAAO,6FACPwC,QAASZ,GACV,IAAKW,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,IAAK,CAAEvC,MAAO,2BAA6B,MAAO,IACtE,qBAAiB,QAAS,YAI3C,KAAuB,CACtB,CAAC,UAAS,WAAOc,QAIjC,IEnIJ+B,EAAE,KACE,MAAMC,GAAM,IAAAC,WAAUC,GAAQC,IAAI,KAC5BC,ECsBDL,EAAE,YAAYM,KAAK,CACxBC,UAAWC,cACXC,YAAa,EACbC,OC5BO,87BFIFC,IAAI,CACLC,SAAU,QACVC,IAAK,QACLC,MAAO,OACPC,MAAO,QACPC,OAAQ,QACRC,OAAQ,KACRC,aAAc,OACdC,UAAW,kCAEVC,SAAS,QACTC,GAAG,OAAQ,YCJb,SACLC,EAA2G,QAE3G,MAAMC,EAAOvB,EAAE,SACZM,KAAK,YAAaE,eAClBgB,OAAOxB,EAAE,eAAgByB,UAAUC,SACnCN,SAASE,EAKd,CDNQK,CAAcC,KAAKC,gBAAgBC,MACnC,MAAMC,EAAQ/B,EAAE4B,KAAKC,gBAAgBG,MACrC/B,EAAIgC,MAAMF,EAAM,IAEhB/B,EAAEK,GAAS6B,UAAU,CACjBC,OAAQ,iBACRC,YAAa,UAErB,GAEAC,8BAA8B,CAAC,CAAE9D,KAAM,OAAQ+D,SAAS,KACxDjD,QAAQkD,eAAe,QAAS,KAC5BlC,EAAQmC,WAGZxC,EAAEyC,QAAQpB,GAAG,WAAY,KACrBpB,EAAIyC,UACJrC,EAAQsC","sources":["src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src/悬浮窗口/Window.vue","webpack://tavern_helper_template/src/悬浮窗口/Window.vue?9fad","src://tavern_helper_template/src/悬浮窗口/index.ts","src://tavern_helper_template/util/script.ts","webpack://tavern_helper_template/util/iframe_srcdoc.html?8b0a"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, unref as _unref, normalizeClass as _normalizeClass, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, isRef as _isRef, vModelText as _vModelText, withDirectives as _withDirectives, vShow as _vShow } from \"vue\";\n\nimport { ref, onMounted } from 'vue';\nconst _hoisted_1 = { class: \"flex flex-col h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-white overflow-hidden\" };\nconst _hoisted_2 = { class: \"window-header flex items-center justify-between px-4 py-3 bg-slate-800/80 border-b border-slate-700 cursor-move select-none\" };\nconst _hoisted_3 = { class: \"flex items-center gap-2\" };\nconst _hoisted_4 = { class: \"flex-1 overflow-auto p-4\" };\nconst _hoisted_5 = { class: \"space-y-4\" };\nconst _hoisted_6 = { class: \"bg-slate-700/50 rounded-lg p-4\" };\nconst _hoisted_7 = { class: \"grid grid-cols-2 gap-2\" };\nconst _hoisted_8 = [\"onClick\"];\nconst _hoisted_9 = { class: \"bg-slate-700/50 rounded-lg p-4\" };\nconst _hoisted_10 = { class: \"text-sm text-slate-400 space-y-1\" };\nconst _hoisted_11 = { class: \"bg-slate-700/50 rounded-lg p-4\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Window',\n    setup(__props) {\n        const minimized = ref(false);\n        const inputText = ref('');\n        const chatId = ref(null);\n        const messageCount = ref(0);\n        const actions = [\n            { name: '刷新', icon: 'fas fa-sync-alt', action: 'refresh' },\n            { name: '清空', icon: 'fas fa-trash', action: 'clear' },\n            { name: '保存', icon: 'fas fa-save', action: 'save' },\n            { name: '设置', icon: 'fas fa-cog', action: 'settings' },\n        ];\n        onMounted(() => {\n            updateInfo();\n            eventOn(tavern_events.CHAT_CHANGED, updateInfo);\n            eventOn(tavern_events.MESSAGE_RECEIVED, updateInfo);\n        });\n        function updateInfo() {\n            chatId.value = SillyTavern.getCurrentChatId();\n            messageCount.value = getLastMessageId() + 1;\n        }\n        function handleAction(action) {\n            switch (action.action) {\n                case 'refresh':\n                    updateInfo();\n                    toastr.info('已刷新信息');\n                    break;\n                case 'clear':\n                    inputText.value = '';\n                    toastr.info('已清空输入');\n                    break;\n                case 'save':\n                    toastr.success('保存成功');\n                    break;\n                case 'settings':\n                    toastr.info('设置功能待实现');\n                    break;\n            }\n        }\n        function handleSubmit() {\n            if (!inputText.value.trim()) {\n                toastr.warning('请输入内容');\n                return;\n            }\n            toastr.success(`已发送: ${inputText.value}`);\n            inputText.value = '';\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createCommentVNode(\" 窗口标题栏 \"),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _cache[2] || (_cache[2] = _createElementVNode(\"div\", { class: \"flex items-center gap-2\" }, [\n                        _createElementVNode(\"i\", { class: \"fas fa-window-maximize text-blue-400\" }),\n                        _createElementVNode(\"span\", { class: \"font-semibold\" }, \"悬浮窗口\")\n                    ], -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"button\", {\n                            class: \"w-6 h-6 flex items-center justify-center rounded hover:bg-slate-600 transition-colors\",\n                            onClick: _cache[0] || (_cache[0] = ($event) => (minimized.value = !_unref(minimized)))\n                        }, [\n                            _createElementVNode(\"i\", {\n                                class: _normalizeClass([_unref(minimized) ? 'fas fa-chevron-down' : 'fas fa-chevron-up', \"text-xs\"])\n                            }, null, 2 /* CLASS */)\n                        ])\n                    ])\n                ]),\n                _createCommentVNode(\" 窗口内容区 \"),\n                _withDirectives(_createElementVNode(\"div\", _hoisted_4, [\n                    _createCommentVNode(\" 自定义内容区域 \"),\n                    _createElementVNode(\"div\", _hoisted_5, [\n                        _createElementVNode(\"div\", _hoisted_6, [\n                            _cache[3] || (_cache[3] = _createElementVNode(\"h3\", { class: \"text-sm font-medium text-slate-300 mb-2\" }, \"快捷操作\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_7, [\n                                (_openBlock(), _createElementBlock(_Fragment, null, _renderList(actions, (action) => {\n                                    return _createElementVNode(\"button\", {\n                                        key: action.name,\n                                        class: \"px-3 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg text-sm transition-colors\",\n                                        onClick: ($event) => (handleAction(action))\n                                    }, [\n                                        _createElementVNode(\"i\", {\n                                            class: _normalizeClass([action.icon, \"mr-1\"])\n                                        }, null, 2 /* CLASS */),\n                                        _createTextVNode(\" \" + _toDisplayString(action.name), 1 /* TEXT */)\n                                    ], 8 /* PROPS */, _hoisted_8);\n                                }), 64 /* STABLE_FRAGMENT */))\n                            ])\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_9, [\n                            _cache[4] || (_cache[4] = _createElementVNode(\"h3\", { class: \"text-sm font-medium text-slate-300 mb-2\" }, \"信息面板\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_10, [\n                                _createElementVNode(\"p\", null, \"当前聊天: \" + _toDisplayString(_unref(chatId) ?? '无'), 1 /* TEXT */),\n                                _createElementVNode(\"p\", null, \"消息数量: \" + _toDisplayString(_unref(messageCount)), 1 /* TEXT */)\n                            ])\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_11, [\n                            _cache[6] || (_cache[6] = _createElementVNode(\"h3\", { class: \"text-sm font-medium text-slate-300 mb-2\" }, \"输入区域\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"textarea\", {\n                                \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => (_isRef(inputText) ? (inputText).value = $event : null)),\n                                class: \"w-full h-20 bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm resize-none focus:outline-none focus:border-blue-500\",\n                                placeholder: \"在此输入内容...\"\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelText, _unref(inputText)]\n                            ]),\n                            _createElementVNode(\"button\", {\n                                class: \"mt-2 w-full px-3 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-sm transition-colors\",\n                                onClick: handleSubmit\n                            }, [...(_cache[5] || (_cache[5] = [\n                                    _createElementVNode(\"i\", { class: \"fas fa-paper-plane mr-1\" }, null, -1 /* CACHED */),\n                                    _createTextVNode(\" 发送 \", -1 /* CACHED */)\n                                ]))])\n                        ])\n                    ])\n                ], 512 /* NEED_PATCH */), [\n                    [_vShow, !_unref(minimized)]\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Window.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Window.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createScriptIdIframe, teleportStyle } from '@util/script';\nimport Window from './Window.vue';\n$(() => {\n    const app = createApp(Window).use(createPinia());\n    const $iframe = createScriptIdIframe()\n        .css({\n        position: 'fixed',\n        top: '100px',\n        right: '20px',\n        width: '320px',\n        height: '400px',\n        zIndex: 9999,\n        borderRadius: '12px',\n        boxShadow: '0 8px 32px rgba(0, 0, 0, 0.3)',\n    })\n        .appendTo('body')\n        .on('load', function () {\n        teleportStyle(this.contentDocument.head);\n        const $body = $(this.contentDocument.body);\n        app.mount($body[0]);\n        // 使用 jquery-ui 实现拖拽\n        $($iframe).draggable({\n            handle: '.window-header',\n            containment: 'window',\n        });\n    });\n    // 添加脚本按钮控制窗口显示/隐藏\n    appendInexistentScriptButtons([{ name: '切换窗口', visible: true }]);\n    eventOn(getButtonEvent('切换窗口'), () => {\n        $iframe.toggle();\n    });\n    // 卸载时清理\n    $(window).on('pagehide', () => {\n        app.unmount();\n        $iframe.remove();\n    });\n});\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n","// Module\nvar code = `<!DOCTYPE html> <html> <head> <link rel=\"stylesheet\" href=\"https://testingcf.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css\"> ${\"<\" + \"script\"} src=\"https://testingcf.jsdelivr.net/gh/n0vi028/JS-Slash-Runner/lib/tailwindcss.min.js\">${\"<\" + \"/script\"}> ${\"<\" + \"script\"} src=\"https://testingcf.jsdelivr.net/npm/jquery\">${\"<\" + \"/script\"}> ${\"<\" + \"script\"} src=\"https://testingcf.jsdelivr.net/npm/jquery-ui/dist/jquery-ui.min.js\">${\"<\" + \"/script\"}> <link rel=\"stylesheet\" href=\"https://testingcf.jsdelivr.net/npm/jquery-ui/themes/base/theme.min.css\"/> ${\"<\" + \"script\"} src=\"https://testingcf.jsdelivr.net/npm/jquery-ui-touch-punch\">${\"<\" + \"/script\"}> ${\"<\" + \"script\"} src=\"https://testingcf.jsdelivr.net/npm/lodash\">${\"<\" + \"/script\"}> ${\"<\" + \"script\"} src=\"https://testingcf.jsdelivr.net/gh/n0vi028/JS-Slash-Runner/src/iframe/adjust_iframe_height.js\">${\"<\" + \"/script\"}> <style>*,::after,::before{box-sizing:border-box}body,html{margin:0!important;padding:0;overflow:hidden!important;max-width:100%!important}</style> </head> <html> </html></html>`;\n// Exports\nexport default code;"],"names":["Vue","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","__name","setup","__props","minimized","ref","inputText","chatId","messageCount","actions","name","icon","action","updateInfo","value","SillyTavern","getCurrentChatId","getLastMessageId","handleSubmit","trim","toastr","success","warning","onMounted","eventOn","tavern_events","CHAT_CHANGED","MESSAGE_RECEIVED","_ctx","_cache","onClick","$event","key","info","placeholder","$","app","createApp","Window","use","$iframe","attr","script_id","getScriptId","frameborder","srcdoc","css","position","top","right","width","height","zIndex","borderRadius","boxShadow","appendTo","on","append_to","$div","append","document","clone","teleportStyle","this","contentDocument","head","$body","body","mount","draggable","handle","containment","appendInexistentScriptButtons","visible","getButtonEvent","toggle","window","unmount","remove"],"sourceRoot":""}